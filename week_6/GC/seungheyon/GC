GC(Garbage Collection) 이란?
GC 는 JVM 에서 동적 메모리 영역의 사용되지 않는(참조되지 않는) 메모리들을 추적하여 해제하는 것을 말한다. 
C언어와 같은 로우 레벨 언어에서는 참조가 끝난 메모리를 개발자가 일일이 할당 해제해 줘야 하지만, Java를 비롯해 가비지 컬렉션을 제공하는 언어에서는 그럴 필요가 없다. 
메모리가 채워짐에 따라 사용하지 않는 메모리를 GC 가 해제해 주기 때문이다.

Java 에서는 Heap 메모리 내에서 객체가 생성되고 할당되는 영역을 Young Generation, Old Generation 의 두 영역으로 나누었다. 
생성된지 얼마 안 된 객체는 Young 영역에 할당되고, 생성되고 시간이 지나도 reachable 상태를 유지하며 살아남은 객체는 Old 영역에 복사된다. 
금방 Unreachable 상태로 되는 객체는 Young 영역에 있다가 사라져버리기도 한다. Young 영역에 대한 가비지 컬렉터를 Minor GC, Old 영역에 대한 가비지 컬렉터를 Major GC 라고 부른다.

 

GC 동작방식
GC 는 기본적인 동작 방식으로 아래 두 단계를 따른다.

Stop The World

 - GC 를 실행하는 스레드를 제외한 모든 스레드들이 작업을 중단( = 애플리케이션 중단), 가비지컬렉션이 끝나면 애플리케이션 재개. -> 성능에 지대한 영향

Mark and Sweep

- 사용되는 메모리와 사용되지 않는 메모리를 식별하여 제거(메모리 해제)하는 작업

-  Mark(사용되고 있는 메모리를 식별함) -> Mark되지 않은 메모리(사용되지 않음으로 식별된 메모리)를 해제하는 작업을 Sweep 이라고 함.

+ Compact 사용되는(reachable) 메모리, 즉 GC 로부터 살아남은 메모리를 Heap의 시작 주소로 모아 압축하는 과정(GC 종류에 따라 실행하지 않는 GC도 있다)

 

MinorGC 동작방식
가비지컬렉션이 동작하는 원리는 객체가 생성되고 적절한 메모리로 할당되는 모든 과정을 포함한다. 즉 객체의 생명주기를 따라간다. 이는 다음 순서로 이루어진다.

1. 처음 생성된 객체는 Young 영역의 Eden 영역에 할당된다. Young 영역은 그 안에서 다시 1개의 Eden 영역과 2개의 Survivor 영역, 즉 3개의 영역으로 나누어진다. 
이 중 Eden 영역은 처음 생성된 객체가 할당되는 곳, Survivor 영역은 Eden 영역에서 GC 를 한번 거친 객체들이 옮겨지는 영역이다. 
Survivor 영역은 두 개지만 반드시 하나의 영역에만 객체가 존재한다.

2. Eden 영역이 가득 차면, MinorGC 가 실행된다. Eden 영역에서 사용되지 않는(Unreachable) 객체는 메모리 해제되고, 사용되는 객체는 비어있던 Survivor 영역으로 옮겨진다. 
같은 시간에 비어있지 않던 Survivor 영역의 메모리 중 사용되지 않는 메모리는 해제되고, 살아남은 메모리는 비어있던 Survivor 영역으로 옮겨지며, 
생존 횟수가 많은 객체는 Old Generation 으로 옮겨진다. 이 과정을 반복하다가 Survivor 영역이 가득 차게 되면, Survivor 영역의 남은 객체를 비어있는 다른 Survivor 영역으로 이동시긴다. 
즉 하나의 Survivor 영역은 반드시 비어있게 된다.


 

 

Major GC 동작방식
Young 영역에서 age가 임계값만큼 증가한 메모리들은 Old 영역으로 Promotion 된다. Major GC는 객체들이 계속 쌓여 Old 영역의 메모리가 부족해지면 발생한다. 
Major GC 는 메모리가 가득 차면 GC 를 실행하여 사용되지 않는 메모리를 해제하는 간단한 방식으로 실행되지만, Minor GC가 작은 메모리 공간을 커버하기에 0.5~1초 정도가 걸리는 데 비해 
Major GC는 상대적으로 큰 공간을 커버하므로 Minor GC보다 최대 10배 이상의 시간을 사용하기도 한다.

 

GC 의 종류(Java 버전별 GC)

Serial GC

Parallel GC

Parallel Old GC

CMS GC

G1 GC
(java 7부터 지원하고 현재는 기본 GC로 채택된 GC)
의 변화 흐름에 대해 정리
